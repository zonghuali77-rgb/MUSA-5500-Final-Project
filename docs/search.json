[
  {
    "objectID": "website/results.html",
    "href": "website/results.html",
    "title": "Results",
    "section": "",
    "text": "This section presents a cross-city comparison of bus stop density and walk-based accessibility indicators. While the underlying methods are consistent across all cities, interpretation must consider each city’s unique transit system design, land-use context, and service philosophy.\n\n\n\n\n\n\nThe four cities show substantial variation in bus stop density:\n\nSingapore (6.58 stops/km²)\nExhibits the highest density, consistent with a fully planned bus system designed to provide short and regular walking access island-wide.\nAmsterdam (4.7 stops/km²)\nDense stop pattern supported by its compact form and the interplay of buses, trams and metro within the historical core.\nShanghai (2.87 stops/km²)\nThe number understates the density of the built-up urban core because the municipal boundary includes very large peripheral, industrial and rural areas.\nNew York City (2.48 stops/km²)\nThe lowest of the four cities, reflecting the bus network’s role as a secondary mode alongside an extensive subway system.\n\n\n\n\nDensity reflects urban form and planning philosophy, not just network size:\n\nStrong central planning → very high density (Singapore)\n\nCompact historic city → medium–high density (Amsterdam)\n\nHuge administrative territory → diluted density (Shanghai)\n\nSubway-dominant transit → lower bus density (NYC)\n\n\n\n\n\n\n\nThe table highlights the interaction between land area and stop counts. Most notably, Shanghai’s density is moderate, but only because its administrative area is exceptionally large."
  },
  {
    "objectID": "website/results.html#bus-stop-density",
    "href": "website/results.html#bus-stop-density",
    "title": "Results",
    "section": "",
    "text": "The four cities show substantial variation in bus stop density:\n\nSingapore (6.58 stops/km²)\nExhibits the highest density, consistent with a fully planned bus system designed to provide short and regular walking access island-wide.\nAmsterdam (4.7 stops/km²)\nDense stop pattern supported by its compact form and the interplay of buses, trams and metro within the historical core.\nShanghai (2.87 stops/km²)\nThe number understates the density of the built-up urban core because the municipal boundary includes very large peripheral, industrial and rural areas.\nNew York City (2.48 stops/km²)\nThe lowest of the four cities, reflecting the bus network’s role as a secondary mode alongside an extensive subway system.\n\n\n\n\nDensity reflects urban form and planning philosophy, not just network size:\n\nStrong central planning → very high density (Singapore)\n\nCompact historic city → medium–high density (Amsterdam)\n\nHuge administrative territory → diluted density (Shanghai)\n\nSubway-dominant transit → lower bus density (NYC)"
  },
  {
    "objectID": "website/results.html#density-summary-table",
    "href": "website/results.html#density-summary-table",
    "title": "Results",
    "section": "",
    "text": "The table highlights the interaction between land area and stop counts. Most notably, Shanghai’s density is moderate, but only because its administrative area is exceptionally large."
  },
  {
    "objectID": "website/results.html#a.-500-m-euclidean-coverage-4757",
    "href": "website/results.html#a.-500-m-euclidean-coverage-4757",
    "title": "Results",
    "section": "A. 500 m Euclidean coverage (≈47–57%)",
    "text": "A. 500 m Euclidean coverage (≈47–57%)\nContrary to earlier expectations, the Euclidean 500 m coverage values are not uniform across cities:\n\n\n\n\n\n\n\n\nCity\nEuclidean Coverage\nInterpretation\n\n\n\n\nAmsterdam (56.8%)\nHighest—compact area and dense core coverage.\n\n\n\nNYC (56.1%)\nSurprisingly high despite low density; reflects concentrated built-up areas and long bus corridors.\n\n\n\nSingapore (55.9%)\nConsistently accessible network resulting from systematic stop spacing.\n\n\n\nShanghai (47.5%)\nLower than the others, because the municipal boundary includes vast low-density tracts where no coverage is intended.\n\n\n\n\n\nWhy Shanghai’s value is lower now\n\nThe boundary used in the analysis is much larger than the functional city.\n\nEven with dense stop spacing in Puxi/Pudong, the outer districts dilute the ratio.\n\nThis does not indicate worse accessibility within the inhabited urban core."
  },
  {
    "objectID": "website/results.html#b.-network-based-500-m-walking-coverage-1643",
    "href": "website/results.html#b.-network-based-500-m-walking-coverage-1643",
    "title": "Results",
    "section": "B. Network-based 500 m walking coverage (≈16–43%)",
    "text": "B. Network-based 500 m walking coverage (≈16–43%)\nThe network-based coverage metric—unlike Euclidean buffers—follows actual walkable streets. It therefore produces much smaller values, which is expected.\n\n\n\n\n\n\n\n\nCity\nNetwork Coverage\nInterpretation\n\n\n\n\nNYC (43.3%)\nHighest, due to extensive walkable street grids and long interconnected bus corridors.\n\n\n\nSingapore (34.0%)\nRegular street layout produces balanced accessibility but limited by natural barriers and expressways.\n\n\n\nAmsterdam (29.6%)\nCompact organic street pattern creates excellent local accessibility but reduces reachable land area at 500 m when measured over the full municipal extent.\n\n\n\nShanghai (15.8%)\nLowest, again driven by the scale of the boundary—outer districts contain large areas with sparse streets or non-residential land.\n\n\n\n\n\nWhy network coverage &lt; Euclidean coverage\nA 500-m circle overestimates walkable distance;\na 500-m network buffer reflects:\n\nbarriers (rivers, rail lines, highways),\n\ncul-de-sac layouts,\n\ndifferences in street connectivity.\n\nThus, network coverage is more realistic."
  },
  {
    "objectID": "website/results.html#c.-nearest-neighbour-distances",
    "href": "website/results.html#c.-nearest-neighbour-distances",
    "title": "Results",
    "section": "C. Nearest-neighbour distances",
    "text": "C. Nearest-neighbour distances\n\n\n\n\n\n\n\n\nCity\nMean NN Dist\nInterpretation\n\n\n\n\nAmsterdam (63 m)\nDense mesh of stops and tram corridors.\n\n\n\nSingapore (79 m)\nRegular spacing aligned with planning guidelines.\n\n\n\nShanghai (91 m)\nTight spacing in urban core, wider gaps in peri-urban districts.\n\n\n\nNYC (183 m)\nWidest spacing due to long blocks and subway-oriented network function.\n\n\n\n\nThe distribution shape (min–max and 90th percentile) confirms:\n\nNYC has the greatest spatial inequality in stop spacing.\n\nAmsterdam/Singapore have consistent, predictable spacing.\n\nShanghai mixes highly dense urban cores with much sparser outer districts."
  },
  {
    "objectID": "website/data_sources.html",
    "href": "website/data_sources.html",
    "title": "Data Sources",
    "section": "",
    "text": "These datasets form the backbone of the quantitative analysis\n(bus stop density, 500 m Euclidean coverage, network-based walking coverage,\nnearest-neighbour distances, and KDE surfaces).\n\n\n\nNew York City\nBorough boundaries from NYC Open Data\n(NYC Borough Boundaries; used to define the built-up area of the five boroughs).\nSingapore\nPlanning area polygons from the 2019 Master Plan on data.gov.sg,\naggregated to the national extent.\nAmsterdam\nAdministrative areas from Open GEO-Data Amsterdam\n(Gemeente Amsterdam – stadsdelen / neighbourhood boundaries).\nShanghai\nCity boundary from Simplemaps (Shanghai polygon extracted from a global cities dataset).\nThis polygon includes some non-built-up land and water areas, but is used as an approximation of the municipal extent due to the lack of free official GIS boundary data.\n\n\n\n\n\nNew York City\nBus Shelters dataset from NYC Open Data.\nThis represents the locations of bus shelters rather than every physical stop pole, but coverage is high and spatially consistent, and is therefore used as a proxy for bus stops.\nSingapore\nBus Stop Locations from the Land Transport Authority (LTA) via data.gov.sg, including official stop codes and coordinates.\nAmsterdam\nOpenStreetMap bus stops (highway=bus_stop) retrieved via the\nOverpass API. These were clipped to the Amsterdam municipal boundary.\nShanghai\nOpenStreetMap bus stops (highway=bus_stop) retrieved via the\nOverpass API, then clipped to the (Simplemaps-based) city boundary.\n\n\n\n\nNetwork-based walking coverage requires a walkable street network for each city. These were obtained from:\n\nOpenStreetMap (OSM) street data\nRetrieved automatically via OSMnx, using the graph_from_place() method with network_type = \"walk\" to filter pedestrian-accessible paths.\n\nFor each city, the resulting networks typically include:\n\npedestrian paths,\n\nsidewalks and crossings,\n\nlocal streets and connectors,\n\nbridges and underpasses where mapped in OSM.\n\nThey generally exclude private or unmapped passages, which may cause network-based accessibility estimates to be conservative in some areas.\n\n\n\n\nOpenStreetMap data (Amsterdam, Shanghai) may miss a small share of minor stops, especially in peripheral areas.\nNYC bus shelters under-represent stops without shelters, but capture the main passenger hubs and urban corridors.\nOpenStreetMap street networks may be less detailed in industrial or peri-urban zones, leading to slightly understated network-based coverage.\nThe Shanghai boundary is broader than the actual built-up area, including river surfaces and some industrial / rural land. This is noted explicitly in the Shanghai city profile and should be kept in mind when comparing densities across cities."
  },
  {
    "objectID": "website/data_sources.html#city-boundaries",
    "href": "website/data_sources.html#city-boundaries",
    "title": "Data Sources",
    "section": "",
    "text": "New York City\nBorough boundaries from NYC Open Data\n(NYC Borough Boundaries; used to define the built-up area of the five boroughs).\nSingapore\nPlanning area polygons from the 2019 Master Plan on data.gov.sg,\naggregated to the national extent.\nAmsterdam\nAdministrative areas from Open GEO-Data Amsterdam\n(Gemeente Amsterdam – stadsdelen / neighbourhood boundaries).\nShanghai\nCity boundary from Simplemaps (Shanghai polygon extracted from a global cities dataset).\nThis polygon includes some non-built-up land and water areas, but is used as an approximation of the municipal extent due to the lack of free official GIS boundary data."
  },
  {
    "objectID": "website/data_sources.html#bus-stops",
    "href": "website/data_sources.html#bus-stops",
    "title": "Data Sources",
    "section": "",
    "text": "New York City\nBus Shelters dataset from NYC Open Data.\nThis represents the locations of bus shelters rather than every physical stop pole, but coverage is high and spatially consistent, and is therefore used as a proxy for bus stops.\nSingapore\nBus Stop Locations from the Land Transport Authority (LTA) via data.gov.sg, including official stop codes and coordinates.\nAmsterdam\nOpenStreetMap bus stops (highway=bus_stop) retrieved via the\nOverpass API. These were clipped to the Amsterdam municipal boundary.\nShanghai\nOpenStreetMap bus stops (highway=bus_stop) retrieved via the\nOverpass API, then clipped to the (Simplemaps-based) city boundary."
  },
  {
    "objectID": "website/data_sources.html#street-networks-for-network-based-coverage",
    "href": "website/data_sources.html#street-networks-for-network-based-coverage",
    "title": "Data Sources",
    "section": "",
    "text": "Network-based walking coverage requires a walkable street network for each city. These were obtained from:\n\nOpenStreetMap (OSM) street data\nRetrieved automatically via OSMnx, using the graph_from_place() method with network_type = \"walk\" to filter pedestrian-accessible paths.\n\nFor each city, the resulting networks typically include:\n\npedestrian paths,\n\nsidewalks and crossings,\n\nlocal streets and connectors,\n\nbridges and underpasses where mapped in OSM.\n\nThey generally exclude private or unmapped passages, which may cause network-based accessibility estimates to be conservative in some areas.\n\n\n\n\nOpenStreetMap data (Amsterdam, Shanghai) may miss a small share of minor stops, especially in peripheral areas.\nNYC bus shelters under-represent stops without shelters, but capture the main passenger hubs and urban corridors.\nOpenStreetMap street networks may be less detailed in industrial or peri-urban zones, leading to slightly understated network-based coverage.\nThe Shanghai boundary is broader than the actual built-up area, including river surfaces and some industrial / rural land. This is noted explicitly in the Shanghai city profile and should be kept in mind when comparing densities across cities."
  },
  {
    "objectID": "website/data_sources.html#overview-page-images",
    "href": "website/data_sources.html#overview-page-images",
    "title": "Data Sources",
    "section": "3.1 Overview page images",
    "text": "3.1 Overview page images\n\nNew York City bus photograph\nImage of an MTA bus in service, used on the “Why these four cities?” page to illustrate the NYC network.\nSource: Bloomberg – “Free NYC buses complicated by bond-paying pledge”.\nSingapore bus network map (image/Singapore_Lines.png)\nStylised bus route map produced by the Land Transport Authority (LTA), used to show the structure of the island-wide network.\nSource: Land Transport Authority, Singapore – Bus Route Map.\nAmsterdam bus photograph / schematic (image/ams_bus.png)\nImage illustrating GVB-operated buses in Amsterdam.\nSource: GVB / Amsterdam public transport promotional materials.\nShanghai bus network overview (image/Shanghai_Lines.png)\nScreenshot of the bus and transit network from Google Maps Transit layer, cropped to the core urban area.\nSource: Google Maps – Transit (Shanghai)."
  },
  {
    "objectID": "website/data_sources.html#city-profile-reference-maps",
    "href": "website/data_sources.html#city-profile-reference-maps",
    "title": "Data Sources",
    "section": "3.2 City profile reference maps",
    "text": "3.2 City profile reference maps\nEach city-specific page includes one additional reference map of the local bus system:\n\nNew York City – Manhattan bus map\n(image/manhattan-bus-map.png)\nExtract from the official MTA Manhattan Bus Map, used as a high-density reference to explain the strong clustering of stops in Manhattan.\nSource: Metropolitan Transportation Authority (MTA) – Official Manhattan Bus Map.\nSingapore – island-wide bus routes\n(image/Singapore_Lines.png)\nLTA’s bus route map showing trunk corridors, expressways and cross-island links. This helps interpret the KDE results and the relatively short nearest-neighbour distances.\nSource: Land Transport Authority, Singapore – Bus Route Map.\nAmsterdam – GVB bus network\n(image/Amsterdam_Lines.png)\nMap of GVB bus lines in greater Amsterdam, highlighting the dense radial routes around the historic centre and links to peripheral districts such as Bijlmer and Slotervaart.\nSource: GVB / Amsterdam bus network map.\nShanghai – Google Transit bus network\n(image/Shanghai_Lines.png)\nGoogle Transit view of Shanghai’s bus network within the main urban municipality, showing radial corridors from the inner ring roads towards the suburbs and connections to metro and railway hubs.\nSource: Google Maps – Transit layer for Shanghai.\n\nThese contextual materials are cited to acknowledge their origin and to clarify that they serve only as visual references, while all quantitative results (densities, coverage, nearest-neighbour distances, network-based coverage and KDE surfaces) are based exclusively on the open spatial datasets listed in Sections 1 and 2."
  },
  {
    "objectID": "website/city_sg.html",
    "href": "website/city_sg.html",
    "title": "Singapore",
    "section": "",
    "text": "Singapore’s bus stops are tightly concentrated within the main urbanised island. The stop pattern broadly follows the public housing new towns from Jurong in the west to Tampines and Pasir Ris in the east, with particularly dense strings of stops along the north–south and east–west corridors that parallel the MRT lines.\nLarge gaps in the north-west and central part of the island coincide with the Central Catchment Nature Reserve, military training areas and low-density industrial land, rather than underserved residential neighbourhoods.\nCompared with New York City, Singapore has fewer extreme peripheral areas: almost all developable land is within a continuous urban fabric. This helps explain why Singapore records the highest bus-stop density in the comparative statistics (about 6.6 stops/km²), considerably higher than New York City (~2.5 stops/km²) and somewhat higher than Amsterdam (~4.7 stops/km²). The morphology of a compact island city-state with strong planning control supports a finely spaced stop network."
  },
  {
    "objectID": "website/city_sg.html#network-based-500-m-coverage",
    "href": "website/city_sg.html#network-based-500-m-coverage",
    "title": "Singapore",
    "section": "2.1 Network-based 500 m coverage",
    "text": "2.1 Network-based 500 m coverage\n\nThe network-based 500 m coverage map constrains walking distance to the actual street network rather than simple circles around stops. Under this more realistic assumption, about 34.0% of Singapore’s land area lies within 500 m walking distance of a bus stop.\nSeveral patterns stand out:\n\nThe accessible area contracts into linear corridors following the main road network, especially along express bus and trunk routes.\nTown centres and interchange areas (e.g. Jurong East, Woodlands, Ang Mo Kio, Tampines) remain strongly covered, confirming that residential neighbourhoods are generally well served.\nCoverage drops sharply inside nature reserves, military areas and port/airport zones, where there are few or no walkable streets and public access is restricted.\n\nThe gap between Euclidean coverage (≈55.9%) and network-based coverage (≈34.0%) is larger here than in some of the other cities. This reflects the presence of:\n\nextensive non-walkable land (reservoirs, forests, fenced-off facilities), and\n\ngrade-separated expressways and large-scale infrastructure that limit pedestrian permeability even when plotted inside a nominal 500 m radius.\n\nIn practice, this means that residential and mixed-use areas are very well covered, but a substantial share of Singapore’s territory is deliberately inaccessible or non-urban. For evaluating everyday access to buses, the network-based map arguably gives a more faithful picture than the simple circular buffers."
  },
  {
    "objectID": "website/city_ams.html",
    "href": "website/city_ams.html",
    "title": "Amsterdam",
    "section": "",
    "text": "Amsterdam’s bus stops are concentrated heavily in the central urban districts (Centrum, West, Zuid, Oost), with an additional secondary cluster around Amstelveen in the south. This produces a “multi-core + strip-like” distribution pattern aligned closely with the city’s spatial structure:\n\nHistoric centre (Centrum) has dense, irregular street networks, resulting in tightly packed bus stop clusters.\nExpansion districts (Zuid, West, Nieuw-West) show more grid-like patterns, reflected in more regular stop spacing.\nAmstelveen serves as a major suburban residential and commercial node, forming the second dense cluster.\n\nCompared with New York, Amsterdam lacks an ultra-dense corridor analogous to Manhattan, and instead resembles Singapore’s multi-nodal structure—although overall density is significantly lower due to different urban form and population patterns."
  },
  {
    "objectID": "website/city_ams.html#m-network-based-walking-coverage",
    "href": "website/city_ams.html#m-network-based-walking-coverage",
    "title": "Amsterdam",
    "section": "2.1 500m Network-based Walking Coverage",
    "text": "2.1 500m Network-based Walking Coverage\n\nWhile Euclidean buffers capture theoretical walking distance, the network-based 500 m coverage accounts for how far a person can walk along actual streets and paths.\nFor Amsterdam, the network-based coverage is approximately 29.6%, which is much lower than the Euclidean estimate of 56.8%.\n\nWhy is network coverage lower?\n\nAmsterdam’s urban form includes extensive waterways, canals, and fragmented street segments, which reduce direct walking routes.\n\nThe city’s historic centre contains narrow alleys, pedestrian-only zones, and discontinuous streets, limiting straight-line access even when stops appear close.\n\nPeripheral districts include green spaces, industrial land, and fenced-off facilities, creating gaps in the walkable network.\n\n\n\nSpatial interpretation\n\nThe central districts still achieve strong coverage, forming a continuous walkable band.\nThe southern corridor toward Amstelveen also shows high connectivity, reflecting well-developed, uninterrupted road structures.\nCoverage becomes patchy in Nieuw-West, Noord, and outer districts where street discontinuity is higher.\n\n\n\nComparison with other cities\n\nAmsterdam’s network-based coverage (29.6%) is:\n\nhigher than Shanghai (15.8%),\n\nsimilar to Singapore (34%),\n\nlower than New York City (43.3%),\nwhich mirrors differences in street permeability and the continuity of walkable links.\n\n\nNetwork analysis thus highlights a crucial nuance:\neven with very dense stop spacing, a city with fragmented street networks will exhibit much lower “effective pedestrian access.”"
  },
  {
    "objectID": "website/city_ams.html#amsterdam-bus-network-gvb-reference",
    "href": "website/city_ams.html#amsterdam-bus-network-gvb-reference",
    "title": "Amsterdam",
    "section": "5. Amsterdam bus network (GVB reference)",
    "text": "5. Amsterdam bus network (GVB reference)\n\nImage source: GVB / Amsterdam public transport – Amsterdam Bus Network Map (via Amsterdam Map 360).\nThe official Amsterdam bus network map provides functional context not visible in point-based KDE and NN graphs.\n\n(1) The city centre forms a “dense transit mesh”\n\nBlue bus lines form a grid within the central ring.\nOverlapping routes create high stop density → matches KDE hotspots.\nUnlike NYC’s north–south corridor model (Manhattan), Amsterdam uses a radial + mesh pattern.\n\n\n\n(2) Amstelveen–Centrum corridor stands out clearly\n\nMajor north–south trunk routes link Amstelveen directly to the central city.\nAligns with the strong KDE linear hotspot in the south.\n\n\n\n(3) Peripheral areas adopt ring-shaped or semi-ring connections\n\nNorth and east edges show fewer routes.\nCorresponds with weaker 500 m coverage and larger NN distances.\nThese areas have lower population density or serve industrial and waterfront functions.\n\n\n\nHow the bus network map complements our spatial metrics:\n\nKDE/NN show spatial density.\nThe lines map reveals functional connectivity.\nCombined, they demonstrate that Amsterdam’s network is:\n\nHighly dense in the centre\nMulti-nodal\nPeripheral-light\nA compact, European-style transit system"
  },
  {
    "objectID": "Transportation Accessibility Project.html",
    "href": "Transportation Accessibility Project.html",
    "title": "Global Bus Accessibility Analysis",
    "section": "",
    "text": "import os\nimport matplotlib.pyplot as plt\n\ndef save_fig(name, dpi=200):\n    \"\"\"Save figure into figures/ directory\"\"\"\n    os.makedirs(\"figures\", exist_ok=True)\n    path = os.path.join(\"figures\", f\"{name}.png\")\n    plt.savefig(path, dpi=dpi, bbox_inches=\"tight\")\n    print(f\"[Saved] {path}\")\n\n\nimport osmnx as ox\nimport networkx as nx\n\nimport requests\nimport pandas as pd\nimport geopandas as gpd\nfrom shapely.geometry import Point\nfrom shapely.ops import unary_union\nimport matplotlib.pyplot as plt\n\nplt.rcParams[\"figure.figsize\"] = (7, 7)\nplt.rcParams[\"axes.titlesize\"] = 12\nplt.rcParams[\"font.size\"] = 10\n\n# ----------------------------\n# City Configuration\n# ----------------------------\n\n# Bounding Box: (Min Latitude, Min Longitude, Max Latitude, Max Longitude)\nCITY_BBOX = {\n    \"nyc\": (40.4774, -74.2591, 40.9176, -73.7004),  # Approximate New York City\n    \"sg\":  (1.2000, 103.6000, 1.4800, 104.0500),    # Singapore\n    \"ams\": (52.2780, 4.7280, 52.4310, 5.0790),      # Amsterdam\n    \"sh\":  (30.90, 121.00, 31.50, 121.98),          # Shanghai\n}\n\nCITY_LABEL = {\n    \"nyc\": \"New York City\",\n    \"sg\":  \"Singapore\",\n    \"ams\": \"Amsterdam\",\n    \"sh\":  \"Shanghai\",\n}\n\n# Projection used for area calculation per city\nCITY_TARGET_CRS = {\n    \"nyc\": \"EPSG:3857\",   \n    \"sg\":  \"EPSG:3414\",   \n    \"ams\": \"EPSG:28992\",  \n    \"sh\":  \"EPSG:3857\",   \n}\n\nCITY_PLACE = {\n    \"nyc\": \"New York City, New York, USA\",\n    \"sg\":  \"Singapore\",\n    \"ams\": \"Amsterdam, Netherlands\",\n    \"sh\":  \"Shanghai, China\",\n}\n\nox.settings.use_cache = True\nox.settings.cache_folder = \"./osm_cache\"  \n\ndef fetch_osm_walk_graph(city):\n    place_name = CITY_PLACE[city]\n    print(f\"\\nFetching OSM walk graph for {CITY_LABEL[city]} ({place_name}) ...\")\n\n    G = ox.graph_from_place(\n        place_name,\n        network_type=\"walk\",  \n        simplify=True\n    )\n\n    print(f\"  → graph nodes={len(G.nodes)}, edges={len(G.edges)}\")\n    return G\n\n\nOVERPASS_URLS = [\n    \"https://overpass-api.de/api/interpreter\",\n    \"https://lz4.overpass-api.de/api/interpreter\",\n    \"https://overpass.kumi.systems/api/interpreter\",\n]\n\n# ---------------------------------------\n# 1) Build Overpass query (for AMS / SH)\n# ---------------------------------------\ndef build_overpass_query_bus_stops(bbox):\n    \"\"\"\n    bbox: (min_lat, min_lon, max_lat, max_lon)\n    \"\"\"\n    min_lat, min_lon, max_lat, max_lon = bbox\n    query = f\"\"\"\n    [out:json][timeout:120];\n    (\n      node[\"highway\"=\"bus_stop\"]({min_lat},{min_lon},{max_lat},{max_lon});\n    );\n    out body;\n    &gt;;\n    out skel qt;\n    \"\"\"\n    return query\n\n\n# ---------------------------------------\n# 2) Unified Bus Stop Retrieval Function\n#    NYC / SG use local files, AMS / SH use Overpass\n# ---------------------------------------\ndef fetch_bus_stops_osm(city):\n    print(f\"\\nFetching bus stops for {CITY_LABEL[city]} ...\")\n\n    # New York City — Local GeoJSON\n    if city == \"nyc\":\n        path = \"data/Bus_Stop_Shelter_20251122.geojson\"\n        print(f\"  → Using local NYC dataset: {path}\")\n        gdf = gpd.read_file(path)\n\n        if gdf.crs is None:\n            gdf = gdf.set_crs(\"EPSG:4326\")\n        else:\n            gdf = gdf.to_crs(\"EPSG:4326\")\n\n        print(f\"  NYC loaded: {len(gdf)} stops\")\n        return gdf\n\n    # Singapore — Local LTA GeoJSON\n    if city == \"sg\":\n        path = \"data/LTABusStop.geojson\"\n        print(f\"  → Using local Singapore dataset: {path}\")\n        gdf = gpd.read_file(path)\n\n        if gdf.crs is None:\n            gdf = gdf.set_crs(\"EPSG:4326\")\n        else:\n            gdf = gdf.to_crs(\"EPSG:4326\")\n\n        print(\"  Singapore loaded\")\n        return gdf\n\n# Amsterdam / Shanghai — Overpass API\n    bbox = CITY_BBOX[city]\n    query = build_overpass_query_bus_stops(bbox)\n\n    print(\"  → Fetching from Overpass API ...\")\n    last_err = None\n    resp = None\n    data = None\n\n    for url in OVERPASS_URLS:\n        try:\n            print(f\"    trying: {url}\")\n            resp = requests.get(url, params={\"data\": query}, timeout=180)\n            resp.raise_for_status()\n            data = resp.json()\n            print(\"    ✓ success\")\n            break\n        except Exception as e:\n            print(f\"    ✗ failed on {url}: {e}\")\n            last_err = e\n            continue\n\n    if data is None:\n        raise last_err\n\n\n    elements = [e for e in data.get(\"elements\", []) if e.get(\"type\") == \"node\"]\n\n    gdf = gpd.GeoDataFrame(\n        elements,\n        geometry=[Point(e[\"lon\"], e[\"lat\"]) for e in elements],\n        crs=\"EPSG:4326\",\n    )\n\n    if \"tags\" in gdf.columns:\n        tags_df = gdf[\"tags\"].apply(pd.Series)\n        gdf = pd.concat([gdf.drop(columns=[\"tags\"]), tags_df], axis=1)\n\n    print(f\"  {CITY_LABEL[city]} fetched: {len(gdf)} stops\")\n    return gdf\n\n# ---------------------------------------\n# 3) Boundary Cleaning (Applicable to All Cities)\n# ---------------------------------------\ndef clean_boundary(gdf):\n    \"\"\"Fix topology and merge multiple polygons\"\"\"\n    gdf = gdf.explode(ignore_index=True)\n    gdf[\"geometry\"] = gdf.geometry.buffer(0)\n    merged = gdf.unary_union\n    return gpd.GeoDataFrame(geometry=[merged], crs=gdf.crs)\n\n\n# ------------------------------\n# 1) Four Cities' Boundary Sources\n# ------------------------------\nBOUNDARY_SOURCES = {\n    # New York City \n    \"nyc\": {\n        \"path\": \"data/nybb.shp\"\n    },\n\n    # Singapore\n    \"sg\": {\n        \"path\": \"data/Singapore_Boundary.geojson\"\n    },\n\n    # Amsterdam\n    \"ams\": {\n        \"path\": \"https://api.data.amsterdam.nl/v1/gebieden/stadsdelen?_format=geojson\"\n    },\n\n    # Shanghai \n    \"sh\": {\n        \"path\": \"data/China_Boundary.json\"\n    },\n}\n\n\n# ------------------------------\n# 2) Load city boundary\n# ------------------------------\ndef load_city_boundary(city):\n    path = BOUNDARY_SOURCES[city][\"path\"]\n\n    print(f\"\\n=== Loading boundary for {CITY_LABEL[city]} ===\")\n    print(f\"  Reading from: {path}\")\n\n    gdf = gpd.read_file(path)\n\n    # Uniform CRS\n    if gdf.crs is None:\n        gdf = gdf.set_crs(epsg=4326)\n    else:\n        gdf = gdf.to_crs(epsg=4326)\n\n    # Shanghai：Filter into Shanghai Municipality \n    if city == \"sh\":\n        if \"adm1_code\" in gdf.columns:\n            gdf = gdf[gdf[\"adm1_code\"] == \"CNSH\"]\n        elif \"iso_3166_2\" in gdf.columns:\n            gdf = gdf[gdf[\"iso_3166_2\"] == \"CNSH\"]\n        elif \"name\" in gdf.columns:\n            gdf = gdf[gdf[\"name\"].str.contains(\"Shanghai\", case=False, na=False)]\n\n        print(\"  → Filtered Shanghai Municipality (CNSH, all polygons kept)\")\n\n    print(f\"  → {len(gdf)} polygons, CRS = {gdf.crs}\")\n    return gdf\n\n\n# Prepare city data: clip + area + density + network graph\ndef prepare_city_data(city):\n    print(f\"\\n=== Processing {CITY_LABEL[city]} ===\")\n\n    G_walk = fetch_osm_walk_graph(city)\n\n    # 1) Load bus stops (EPSG:4326)\n    stops = fetch_bus_stops_osm(city)\n    if len(stops) == 0:\n        print(\"⚠ No bus stops, skip\")\n        return None\n\n    stops_gdf = gpd.GeoDataFrame(stops, geometry=stops.geometry, crs=\"EPSG:4326\")\n\n    # 2) Load city boundaries\n    boundary_raw = load_city_boundary(city)\n\n    # 3) General cleaning (topology repair + merge)\n    boundary = clean_boundary(boundary_raw)\n    boundary_4326 = boundary.to_crs(\"EPSG:4326\")\n\n    # 4) Clip: Retain only stops within the city\n    stops_clipped = gpd.clip(stops_gdf, boundary_4326)\n\n    # 5) Project to target CRS\n    target_crs = CITY_TARGET_CRS[city]\n    boundary_proj = boundary_4326.to_crs(target_crs)\n    stops_proj = stops_clipped.to_crs(target_crs)\n\n    # 5.1 Street Network Projection\n    G_proj = ox.project_graph(G_walk, to_crs=target_crs)\n    nodes_proj, edges_proj = ox.graph_to_gdfs(G_proj)\n\n    # 6) Area & density\n    area_m2 = boundary_proj.geometry.area.sum()\n    area_km2 = area_m2 / 1e6\n\n    n_stops = len(stops_proj)\n    density = n_stops / area_km2 if area_km2 &gt; 0 else None\n\n    print(\n        f\"{CITY_LABEL[city]} area ≈ {area_km2:.1f} km², \"\n        f\"stops={n_stops}, density={density:.3f}\"\n    )\n\n    return {\n        \"boundary_4326\": boundary_4326,\n        \"boundary_proj\": boundary_proj,\n        \"stops_4326\": stops_gdf,\n        \"stops_clipped_4326\": stops_clipped,\n        \"stops_proj\": stops_proj,\n        \"area_km2\": area_km2,\n        \"n_stops\": n_stops,\n        \"density\": density,\n        \"G_walk\": G_walk,\n        \"G_proj\": G_proj,\n        \"nodes_proj\": nodes_proj,\n        \"edges_proj\": edges_proj,\n    }\n\n\ndef plot_city_map(city, data, save=False):\n    b = data[\"boundary_4326\"]\n    s = data[\"stops_clipped_4326\"]\n\n    fig, ax = plt.subplots(figsize=(6, 6))\n    b.boundary.plot(ax=ax, linewidth=1, edgecolor=\"black\")\n    s.plot(ax=ax, color=\"red\", markersize=2)\n    ax.set_title(f\"{CITY_LABEL[city]}: Bus Stops\")\n\n    if save:\n        save_fig(f\"{city}_bus_stops\")\n\n    plt.show()\n\n\n# ------------------------------\n# Calculate Density for Four Cities\n# ------------------------------\nresults = {}\nfor c in [\"nyc\", \"sg\", \"ams\", \"sh\"]:\n    r = prepare_city_data(c)\n    if r is not None:\n        results[c] = r\n\n# ------------------------------\n# Individual city map plotting + saving\n# ------------------------------\nfor c, r in results.items():\n    plot_city_map(c, r, save=True)\n\n\n# ------------------------------\n# Summary DataFrame\n# ------------------------------\nsummary_df = pd.DataFrame([\n    {\n        \"city\": CITY_LABEL[c],\n        \"area_km2\": r[\"area_km2\"],\n        \"n_stops\": r[\"n_stops\"],\n        \"density_stops_per_km2\": r[\"density\"]\n    }\n    for c, r in results.items()\n])\n\nprint(\"\\n=== Density Summary ===\")\nprint(summary_df)\n\n\n# ------------------------------\n# Plot density comparison bar chart + saving\n# ------------------------------\nfig, ax = plt.subplots(figsize=(8, 4))\n\nax.bar(\n    summary_df[\"city\"],\n    summary_df[\"density_stops_per_km2\"]\n)\n\nax.set_ylabel(\"Bus Stops per km²\")\nax.set_title(\"Bus Stop Density Comparison\")\nplt.xticks(rotation=20)\nplt.tight_layout()\n\nsave_fig(\"density_bar_chart\")   \nplt.show()\n\n\n# ------------------------------\n# Save summary_df as a table figure\n# ------------------------------\nfig, ax = plt.subplots(figsize=(6, 1.5))\nax.axis(\"off\")\n\nsummary_to_show = summary_df.copy()\nsummary_to_show[\"area_km2\"] = summary_to_show[\"area_km2\"].round(1)\nsummary_to_show[\"density_stops_per_km2\"] = summary_to_show[\"density_stops_per_km2\"].round(2)\n\ntable = ax.table(\n    cellText=summary_to_show.values,\n    colLabels=summary_to_show.columns,\n    loc=\"center\"\n)\n\ntable.auto_set_font_size(False)\ntable.set_fontsize(8)\ntable.auto_set_column_width(col=list(range(len(summary_to_show.columns))))\n\nsave_fig(\"density_summary_table\")  # figures/density_summary_table.png\nplt.show()\n\n\n=== Processing New York City ===\n\nFetching OSM walk graph for New York City (New York City, New York, USA) ...\n  → graph nodes=267568, edges=860004\n\nFetching bus stops for New York City ...\n  → Using local NYC dataset: data/Bus_Stop_Shelter_20251122.geojson\n  NYC loaded: 3381 stops\n\n=== Loading boundary for New York City ===\n  Reading from: data/nybb.shp\n  → 5 polygons, CRS = EPSG:4326\n\n\nC:\\Users\\Eve Li\\AppData\\Local\\Temp\\ipykernel_35832\\404197951.py:112: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.\n  merged = gdf.unary_union\n\n\nNew York City area ≈ 1362.7 km², stops=3381, density=2.481\n\n=== Processing Singapore ===\n\nFetching OSM walk graph for Singapore (Singapore) ...\n  → graph nodes=180152, edges=508528\n\nFetching bus stops for Singapore ...\n  → Using local Singapore dataset: data/LTABusStop.geojson\n  Singapore loaded\n\n=== Loading boundary for Singapore ===\n  Reading from: data/Singapore_Boundary.geojson\n  → 55 polygons, CRS = EPSG:4326\n\n\nC:\\Users\\Eve Li\\AppData\\Local\\Temp\\ipykernel_35832\\404197951.py:112: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.\n  merged = gdf.unary_union\n\n\nSingapore area ≈ 784.9 km², stops=5161, density=6.575\n\n=== Processing Amsterdam ===\n\nFetching OSM walk graph for Amsterdam (Amsterdam, Netherlands) ...\n  → graph nodes=48778, edges=135830\n\nFetching bus stops for Amsterdam ...\n  → Fetching from Overpass API ...\n    trying: https://overpass-api.de/api/interpreter\n    ✓ success\n  Amsterdam fetched: 1592 stops\n\n=== Loading boundary for Amsterdam ===\n  Reading from: https://api.data.amsterdam.nl/v1/gebieden/stadsdelen?_format=geojson\n  → 9 polygons, CRS = EPSG:4326\n\n\nC:\\Users\\Eve Li\\AppData\\Local\\Temp\\ipykernel_35832\\404197951.py:112: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.\n  merged = gdf.unary_union\n\n\nAmsterdam area ≈ 243.7 km², stops=1145, density=4.699\n\n=== Processing Shanghai ===\n\nFetching OSM walk graph for Shanghai (Shanghai, China) ...\n\n\nC:\\Program Files\\ArcGIS\\Pro\\bin\\Python\\envs\\osm\\lib\\site-packages\\osmnx\\_overpass.py:271: UserWarning: This area is 28 times your configured Overpass max query area size. It will automatically be divided up into multiple sub-queries accordingly. This may take a long time.\n  multi_poly_proj = utils_geo._consolidate_subdivide_geometry(poly_proj)\n\n\n  → graph nodes=169379, edges=486902\n\nFetching bus stops for Shanghai ...\n  → Fetching from Overpass API ...\n    trying: https://overpass-api.de/api/interpreter\n    ✓ success\n  Shanghai fetched: 24189 stops\n\n=== Loading boundary for Shanghai ===\n  Reading from: data/China_Boundary.json\n  → Filtered Shanghai Municipality (CNSH, all polygons kept)\n  → 1 polygons, CRS = EPSG:4326\n\n\nC:\\Users\\Eve Li\\AppData\\Local\\Temp\\ipykernel_35832\\404197951.py:112: DeprecationWarning: The 'unary_union' attribute is deprecated, use the 'union_all()' method instead.\n  merged = gdf.unary_union\n\n\nShanghai area ≈ 8114.9 km², stops=23273, density=2.868\n[Saved] figures\\nyc_bus_stops.png\n\n\n\n\n\n\n\n\n\n[Saved] figures\\sg_bus_stops.png\n\n\n\n\n\n\n\n\n\n[Saved] figures\\ams_bus_stops.png\n\n\n\n\n\n\n\n\n\n[Saved] figures\\sh_bus_stops.png\n\n\n\n\n\n\n\n\n\n\n=== Density Summary ===\n            city     area_km2  n_stops  density_stops_per_km2\n0  New York City  1362.686006     3381               2.481129\n1      Singapore   784.920610     5161               6.575187\n2      Amsterdam   243.652458     1145               4.699316\n3       Shanghai  8114.928199    23273               2.867924\n[Saved] figures\\density_bar_chart.png\n\n\n\n\n\n\n\n\n\n[Saved] figures\\density_summary_table.png\n\n\n\n\n\n\n\n\n\n\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom sklearn.neighbors import KernelDensity\nfrom shapely.geometry import Point\nfrom shapely.ops import unary_union\nimport geopandas as gpd\n\n\n# ======================================================\n# 1) 500m Euclidean Coverage + Map\n# ======================================================\n\nfrom shapely.ops import unary_union\nimport matplotlib.pyplot as plt\nimport geopandas as gpd\n\ndef bus_coverage_analysis(city, result, buffer_m=500, plot=True):\n    stops_proj = result[\"stops_proj\"]\n    boundary_proj = result[\"boundary_proj\"]\n\n    if stops_proj.empty:\n        print(f\"⚠ {CITY_LABEL[city]}: no stops in stops_proj.\")\n        return None, None\n\n    # 1) Euclidean geometry buffer\n    buffers = stops_proj.buffer(buffer_m)\n    merged = unary_union(buffers)\n\n    # 2) intersecting with the city boundary\n    coverage_geom = gpd.GeoDataFrame(\n        geometry=[merged],\n        crs=boundary_proj.crs\n    )\n    covered = gpd.overlay(coverage_geom, boundary_proj, how=\"intersection\")\n\n    if covered.empty:\n        print(f\"⚠ {CITY_LABEL[city]}: covered area is empty.\")\n        return None, None\n\n    covered_area = covered.geometry.area.sum()\n    total_area = boundary_proj.geometry.area.sum()\n    coverage = covered_area / total_area if total_area &gt; 0 else None\n\n    fig = None\n    if plot:\n        fig, ax = plt.subplots(figsize=(7, 7))\n        boundary_proj.boundary.plot(ax=ax, color=\"black\")\n        covered.plot(ax=ax, alpha=0.5)\n        stops_proj.plot(ax=ax, color=\"red\", markersize=5)\n        ax.set_title(f\"{CITY_LABEL[city]} – {buffer_m}m Euclidean Coverage\")\n        ax.set_axis_off()\n        return coverage, fig\n\n    return coverage, None\n\n\n# ======================================================\n# 2) Network Buffer + Map\n# ======================================================\n\ndef make_network_coverage_polygon(result, buffer_m=500, street_buffer=40):\n    G_proj = result[\"G_proj\"]\n    boundary_proj = result[\"boundary_proj\"]\n    stops_proj = result[\"stops_proj\"]\n\n    if stops_proj.empty:\n        print(\"⚠ No stops in city (stops_proj empty)\")\n        return None\n\n    # 1) Snap the site to the nearest network node (coordinate system unified to target_crs)\n    xs = stops_proj.geometry.x.values\n    ys = stops_proj.geometry.y.values\n    stop_nodes = ox.distance.nearest_nodes(G_proj, X=xs, Y=ys)\n\n    # 2) Perform a single-source shortest path calculation for each site node, collecting all reachable nodes within buffer_m\n    nodes_within = set()\n    for sn in stop_nodes:\n        lengths = nx.single_source_dijkstra_path_length(\n            G_proj,\n            sn,\n            cutoff=buffer_m,\n            weight=\"length\"  \n        )\n        nodes_within.update(lengths.keys())\n\n    if not nodes_within:\n        print(\"⚠ No reachable nodes within buffer_m, return None\")\n        return None\n\n    # 3) Subgraph extraction\n    G_sub = G_proj.subgraph(nodes_within).copy()\n    nodes_sub, edges_sub = ox.graph_to_gdfs(G_sub)\n\n    if edges_sub.empty:\n        print(\"⚠ No edges in subgraph, return None\")\n        return None\n\n    # 4) Buffer accessible roads (line → surface)\n    edge_buffers = edges_sub.geometry.buffer(street_buffer)\n    merged = unary_union(edge_buffers)\n\n    # 5) Intersecting with the city boundary yields the final coverage area\n    coverage_geom = gpd.GeoDataFrame(\n        geometry=[merged],\n        crs=boundary_proj.crs\n    )\n    coverage_clipped = gpd.overlay(\n        coverage_geom,\n        boundary_proj,\n        how=\"intersection\"\n    )\n\n    return coverage_clipped\n\n\ndef bus_network_coverage(city, result, buffer_m=500, street_buffer=40, plot=True):\n    if result is None:\n        print(f\"⚠ {CITY_LABEL[city]}: result is None, skip.\")\n        return None, None\n\n    boundary_proj = result[\"boundary_proj\"]\n\n    coverage_gdf = make_network_coverage_polygon(\n        result,\n        buffer_m=buffer_m,\n        street_buffer=street_buffer\n    )\n\n    if coverage_gdf is None or coverage_gdf.empty:\n        print(f\"⚠ {CITY_LABEL[city]}: coverage polygon is empty.\")\n        return None, None\n\n    covered_area = coverage_gdf.geometry.area.sum()\n    total_area = boundary_proj.geometry.area.sum()\n    coverage_ratio = covered_area / total_area if total_area &gt; 0 else None\n\n    fig = None\n    if plot:\n        fig, ax = plt.subplots(figsize=(7, 7))\n        boundary_proj.boundary.plot(ax=ax, color=\"black\", linewidth=0.8)\n        coverage_gdf.plot(ax=ax, alpha=0.5)\n        result[\"stops_proj\"].plot(ax=ax, color=\"red\", markersize=4)\n        ax.set_title(\n            f\"{CITY_LABEL[city]} – {buffer_m}m Network Buffer Coverage\\n\"\n            f\"(coverage ≈ {coverage_ratio:.3f})\"\n        )\n        ax.set_axis_off()\n\n    return coverage_ratio, fig\n\n\n# ======================================================\n# 3) KDE Heatmap (Kernel Density Estimation)\n# ======================================================\n\nfrom sklearn.neighbors import KernelDensity\nimport numpy as np\n\ndef bus_kde_heatmap(city, result, bandwidth_m=300, grid_size=200):\n    stops_proj = result[\"stops_proj\"]\n    boundary_proj = result[\"boundary_proj\"]\n\n    X = np.vstack([stops_proj.geometry.x, stops_proj.geometry.y]).T\n    kde = KernelDensity(bandwidth=bandwidth_m, kernel=\"gaussian\")\n    kde.fit(X)\n\n    minx, miny, maxx, maxy = boundary_proj.total_bounds\n    xx, yy = np.meshgrid(\n        np.linspace(minx, maxx, grid_size),\n        np.linspace(miny, maxy, grid_size)\n    )\n    xy_sample = np.vstack([xx.ravel(), yy.ravel()]).T\n    zz = np.exp(kde.score_samples(xy_sample)).reshape(xx.shape)\n\n    fig, ax = plt.subplots(figsize=(7, 7))\n    ax.imshow(zz, extent=(minx, maxx, miny, maxy), origin=\"lower\", cmap=\"hot\", alpha=0.6)\n    boundary_proj.boundary.plot(ax=ax, color=\"black\", linewidth=1)\n    ax.set_title(f\"{CITY_LABEL[city]} — KDE Heatmap\")\n\n    return xx, yy, zz, fig\n\n\n# ======================================================\n# 4) Nearest Neighbor Distance\n# ======================================================\n\nfrom sklearn.neighbors import KDTree\n\ndef nearest_stop_analysis(city, result, plot=True):\n    stops_proj = result[\"stops_proj\"]\n    coords = np.vstack([stops_proj.geometry.x, stops_proj.geometry.y]).T\n\n    tree = KDTree(coords)\n    dist, _ = tree.query(coords, k=2)\n    stops_proj = stops_proj.copy()\n    stops_proj[\"nn_dist\"] = dist[:, 1]\n\n    if plot:\n        fig, ax = plt.subplots(1, 2, figsize=(12, 5))\n        \n        ax[0].hist(stops_proj[\"nn_dist\"], bins=40, color=\"gray\")\n        ax[0].set_title(f\"{CITY_LABEL[city]} — NN Distance Histogram\")\n\n        boundary_proj = result[\"boundary_proj\"]\n        boundary_proj.boundary.plot(ax=ax[1], color=\"black\")\n        stops_proj.plot(ax=ax[1], column=\"nn_dist\", cmap=\"viridis\", markersize=5, legend=True)\n        ax[1].set_title(f\"{CITY_LABEL[city]} — Nearest Stop Distance Map\")\n\n        return stops_proj, fig\n\n    return stops_proj, None\n\n\n# ======================================================\n# 4) Full City Section: Save All 4 Figures\n# ======================================================\n\ndef full_city_section(city, result, buffer_m=500, bandwidth_m=300, grid_size=200):\n    print(\"\\n\" + \"=\"*60)\n    print(f\"########  {CITY_LABEL[city]} — Full Analysis  ########\")\n    print(\"=\"*60)\n\n    # 1) Euclidean 500m Coverage map\n    cov_euc, fig_cov_euc = bus_coverage_analysis(\n        city,\n        result,\n        buffer_m=buffer_m,\n        plot=True\n    )\n    if fig_cov_euc is not None:\n        save_fig(f\"{city}_coverage_500m\")\n        plt.close(fig_cov_euc)\n\n    # 2) Network Buffer Coverage map\n    cov_net, fig_cov_net = bus_network_coverage(\n        city,\n        result,\n        buffer_m=buffer_m,\n        street_buffer=40,\n        plot=True\n    )\n    if fig_cov_net is not None:\n        save_fig(f\"{city}_coverage_{buffer_m}m_network\")\n        plt.close(fig_cov_net)\n\n    # 3) KDE\n    xx, yy, zz, fig_kde = bus_kde_heatmap(\n        city,\n        result,\n        bandwidth_m=bandwidth_m,\n        grid_size=grid_size\n    )\n    if fig_kde is not None:\n        save_fig(f\"{city}_kde_bw{bandwidth_m}\")\n        plt.close(fig_kde)\n\n    # 4) Nearest Neighbor\n    nn_gdf, fig_nn = nearest_stop_analysis(city, result, plot=True)\n    if fig_nn is not None:\n        save_fig(f\"{city}_nearest_neighbor\")\n        plt.close(fig_nn)\n\n    return {\n        \"coverage_500m_euclidean\": cov_euc,\n        \"coverage_500m_network\": cov_net,\n        \"kde\": (xx, yy, zz),\n        \"nearest\": nn_gdf,\n    }\n\n\nBANDWIDTH_CONFIG = {\n    \"nyc\": 400,\n    \"sg\": 300,\n    \"ams\": 250,\n    \"sh\": 350,\n}\n\ndetail_stats = {}\n\nfor c, r in results.items():\n    bw = BANDWIDTH_CONFIG[c]\n    detail_stats[c] = full_city_section(\n        c,\n        r,\n        buffer_m=500,\n        bandwidth_m=bw,\n        grid_size=200\n    )\n\n\n============================================================\n########  New York City — Full Analysis  ########\n============================================================\n[Saved] figures\\nyc_coverage_500m.png\n[Saved] figures\\nyc_coverage_500m_network.png\n[Saved] figures\\nyc_kde_bw400.png\n[Saved] figures\\nyc_nearest_neighbor.png\n\n============================================================\n########  Singapore — Full Analysis  ########\n============================================================\n[Saved] figures\\sg_coverage_500m.png\n[Saved] figures\\sg_coverage_500m_network.png\n[Saved] figures\\sg_kde_bw300.png\n[Saved] figures\\sg_nearest_neighbor.png\n\n============================================================\n########  Amsterdam — Full Analysis  ########\n============================================================\n[Saved] figures\\ams_coverage_500m.png\n[Saved] figures\\ams_coverage_500m_network.png\n[Saved] figures\\ams_kde_bw250.png\n[Saved] figures\\ams_nearest_neighbor.png\n\n============================================================\n########  Shanghai — Full Analysis  ########\n============================================================\n[Saved] figures\\sh_coverage_500m.png\n[Saved] figures\\sh_coverage_500m_network.png\n[Saved] figures\\sh_kde_bw350.png\n[Saved] figures\\sh_nearest_neighbor.png\n\n\n\n# ======================================================\n# 5) Summarize detailed accessibility stats for each city\n# ======================================================\nimport numpy as np\n\naccess_summary_rows = []\n\nfor c, stats in detail_stats.items():\n    cov_euc = stats[\"coverage_500m_euclidean\"]   \n    cov_net = stats[\"coverage_500m_network\"]     \n    nn_gdf  = stats[\"nearest\"]                   \n    nn_dist = nn_gdf[\"nn_dist\"].values\n\n    area_total   = results[c][\"area_km2\"]\n    area_euc     = cov_euc * area_total if cov_euc is not None else None\n    area_net     = cov_net * area_total if cov_net is not None else None\n\n    access_summary_rows.append({\n        \"city_code\": c,\n        \"city\": CITY_LABEL[c],\n        \"area_km2\": area_total,\n\n        # Euclidean 500m\n        \"cov_euclid_ratio\": cov_euc,\n        \"cov_euclid_pct\": cov_euc * 100 if cov_euc is not None else None,\n        \"area_cov_euclid_km2\": area_euc,\n\n        # Network 500m\n        \"cov_network_ratio\": cov_net,\n        \"cov_network_pct\": cov_net * 100 if cov_net is not None else None,\n        \"area_cov_network_km2\": area_net,\n\n        # Nearest Neighbor Distance\n        \"nn_mean_m\": nn_dist.mean(),\n        \"nn_median_m\": np.median(nn_dist),\n        \"nn_p90_m\": np.percentile(nn_dist, 90),\n        \"nn_min_m\": nn_dist.min(),\n        \"nn_max_m\": nn_dist.max(),\n\n        \"n_stops\": results[c][\"n_stops\"],\n    })\n\naccess_summary_df = pd.DataFrame(access_summary_rows)\n\nrounded_access_summary = access_summary_df.round({\n    \"area_km2\": 1,\n    \"cov_euclid_pct\": 1,\n    \"area_cov_euclid_km2\": 1,\n    \"cov_network_pct\": 1,\n    \"area_cov_network_km2\": 1,\n    \"nn_mean_m\": 1,\n    \"nn_median_m\": 1,\n    \"nn_p90_m\": 1,\n    \"nn_min_m\": 1,\n    \"nn_max_m\": 1,\n})\n\nprint(\"\\n=== Detailed Accessibility Summary ===\")\nprint(rounded_access_summary)\n\nfig, ax = plt.subplots(figsize=(10, 3))\nax.axis(\"off\")\n\ntable = ax.table(\n    cellText=rounded_access_summary.values,\n    colLabels=rounded_access_summary.columns,\n    loc=\"center\"\n)\n\ntable.auto_set_font_size(False)\ntable.set_fontsize(8)\ntable.auto_set_column_width(col=list(range(len(rounded_access_summary.columns))))\n\nsave_fig(\"detailed_accessibility_summary\")\nplt.show()\n\n\n=== Detailed Accessibility Summary ===\n  city_code           city  area_km2  cov_euclid_ratio  cov_euclid_pct  \\\n0       nyc  New York City    1362.7          0.561071            56.1   \n1        sg      Singapore     784.9          0.558901            55.9   \n2       ams      Amsterdam     243.7          0.567725            56.8   \n3        sh       Shanghai    8114.9          0.475103            47.5   \n\n   area_cov_euclid_km2  cov_network_ratio  cov_network_pct  \\\n0                764.6           0.432650             43.3   \n1                438.7           0.340349             34.0   \n2                138.3           0.296061             29.6   \n3               3855.4           0.157866             15.8   \n\n   area_cov_network_km2  nn_mean_m  nn_median_m  nn_p90_m  nn_min_m  nn_max_m  \\\n0                 589.6      183.2        108.2     393.7       0.1    2417.4   \n1                 267.1       79.7         57.1     161.4       0.0    1098.4   \n2                  72.1       63.3         39.2     133.8       1.7     687.0   \n3                1281.1       91.3         56.4     201.4       2.2    1266.4   \n\n   n_stops  \n0     3381  \n1     5161  \n2     1145  \n3    23273  \n[Saved] figures\\detailed_accessibility_summary.png\n\n\n\n\n\n\n\n\n\n\ncov_euc_sh, _ = bus_coverage_analysis(\"sh\", results[\"sh\"], buffer_m=500, plot=False)\ncov_net_sh, _ = bus_network_coverage(\"sh\", results[\"sh\"], buffer_m=500, street_buffer=40, plot=False)\n\nprint(\"Shanghai Euclidean 500m coverage:\", cov_euc_sh)\nprint(\"Shanghai Network   500m coverage:\", cov_net_sh)\n\nShanghai Euclidean 500m coverage: 0.47510304011779425\nShanghai Network   500m coverage: 0.1578661109615834"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Global Bus Accessibility Analysis",
    "section": "",
    "text": "Public transport accessibility is a central concern in contemporary urban planning. A dense and well-distributed bus network can reduce car dependence, support social equity, and connect residents to jobs, education, and essential services. At the same time, many large cities worldwide are facing pressures from rapid urbanisation, climate change, and increasing socio-spatial inequality. Understanding where bus services are abundant – and where gaps remain – is therefore both a technical and a normative question.\nThis project investigates bus stop accessibility in four major metropolitan areas:\n\nNew York City (USA)\n\nSingapore\n\nAmsterdam (Netherlands)\n\nShanghai (China)\n\nTogether, these cities span different continents, governance regimes, urban forms, and data environments. Comparing them side by side allows us to see how different planning traditions and data infrastructures are reflected in the spatial patterns of bus service."
  },
  {
    "objectID": "index.html#city-bus-systems-in-context",
    "href": "index.html#city-bus-systems-in-context",
    "title": "Global Bus Accessibility Analysis",
    "section": "City Bus Systems in Context",
    "text": "City Bus Systems in Context\nAlthough this project focuses on bus stop locations rather than service operations, it is important to understand the broader context of each city’s bus system. The brief profiles below summarise key features that inform the interpretation of the spatial patterns.\n\nNew York City\n\nImage source: Bloomberg – Free NYC buses complicated by bond-paying pledge\nNew York City’s bus network is operated under MTA Regional Bus Operations (RBO), which consolidates services provided by MTA New York City Bus and MTA Bus Company. Together they form one of the largest bus systems in the world, with a fleet of over 5,000 vehicles, more than 300 routes, and many services operating 24/7. The network includes local stopping routes, limited-stop and express lines, as well as Select Bus Service corridors that approximate bus rapid transit. Historically separate operating companies – including several private operators in Queens and express services from the outer boroughs – have gradually been integrated into a unified fare and scheduling system. As a result, the spatial footprint of bus stops reflects both legacy private franchises and later rationalisation efforts by the MTA.\n\n\nSingapore\n\nImage source: Trapeze Group – Bus services in Singapore\nSingapore’s bus system is highly structured and formally categorised. Routes are differentiated into trunk services linking major towns, feeder services circulating within neighbourhoods, express and peak-hour routes that skip lower-demand stops, short-trip variants of longer lines, special industrial services to Jurong and Tuas, cross-border services to Malaysia, and a range of niche services such as Resorts World Sentosa shuttles and privately operated “Scheme B” routes. Under the Bus Contracting Model, services are organised into packages and competitively tendered to different operators, while the Land Transport Authority plans the overall network. This institutional set-up tends to produce relatively systematic spacing of stops and strong coordination between buses and the MRT network.\n\n\nAmsterdam\n\nImage source: GVB Amsterdam takes the first step with battery-electric buses\nIn Amsterdam, buses complement an already dense tram and metro system. Within the municipality, city buses are mainly operated by GVB and serve outer neighbourhoods and corridors that are not covered by tram or metro. Regional bus companies such as Connexxion, EBS, and Transdev connect Amsterdam with surrounding towns and key visitor destinations in the wider region (for example the Waterland villages, Zaanse Schans, and Schiphol Airport). For visitors and commuters, the Amsterdam & Region Travel Ticket provides integrated access to these services across operators. The result is a bus stop pattern that is strongly shaped by inter-operator coordination and the presence of multiple overlapping modes.\n\n\nShanghai\n\nImage source: The China Journey – Shanghai travel guide\nShanghai’s bus network is large, multi-operator, and highly differentiated. More than ten bus companies operate roughly 1,600 routes that link the dense central districts with rapidly expanding suburban areas. Regular urban lines are numbered (roughly from 1 to the 900s), while additional labels distinguish cross-river and tunnel services, district and suburban routes, night buses, peak-hour express lines, and local shuttle services designed to solve the “last-kilometre” connection to metro stations and between major roads and residential communities. On most inner-city routes, stop announcements are made in Mandarin, Shanghainese, and English, reflecting the city’s multilingual context. This complex operational structure contributes to a very dense but spatially heterogeneous pattern of bus stops.\nThe cities were selected for three main reasons:\n\nDiverse planning and transit models\n\nNew York City represents a large, polycentric North American metropolis with a long history of high-capacity transit (subway, commuter rail) and a dense but uneven bus network.\n\nSingapore is a compact city-state with a strongly integrated public transport system, where bus routes are carefully coordinated with the MRT network and land-use planning.\n\nAmsterdam exemplifies a European approach to sustainable mobility, with a combination of rail, tram, bus, and high levels of walking and cycling.\n\nShanghai is a rapidly developed megacity where metro expansion and bus network restructuring have taken place at remarkable speed over the last two decades.\n\nThese contrasting contexts offer a natural laboratory for exploring how bus stop patterns emerge under different planning paradigms.\nVariation in open data and data sources\nThe four cities also differ in how transit and boundary data are made available:\n\nNew York City and Singapore provide rich, curated datasets via open data portals.\n\nAmsterdam publishes detailed administrative boundaries, while bus stops are obtained from OpenStreetMap.\n\nShanghai lacks comprehensive official open transit data, so OpenStreetMap, via the Overpass API, is used as the main bus stop source, and Simplemaps is used for municipal boundaries.\n\nThis mix reflects the reality that urban researchers often rely on a combination of official and volunteered geographic information (VGI).\nComparability as large global cities\nAll four are large, economically significant cities with extensive public transport systems and substantial daily ridership. Comparing bus stop accessibility across them therefore speaks to broader questions about global urban mobility and spatial justice, rather than to small idiosyncratic cases."
  },
  {
    "objectID": "website/about.html",
    "href": "website/about.html",
    "title": "About the Author",
    "section": "",
    "text": "My name is Zonghua Li, and I am a second-year Master’s student in City Planning with a concentration in Smart Cities. This project was developed as part of a Python-based course on geospatial analytics and urban data science.\nMy academic interests focus on:\n\npublic transport systems and transit-oriented development (TOD),\n\naccessibility and spatial equity in cities,\n\napplying open data platforms and open-source geospatial tools to urban analysis.\n\nThis website represents my final project, where I used Python, GeoPandas, and Quarto to construct an end-to-end analytical workflow that includes:\n\ncollecting and cleaning spatial datasets from multiple public sources,\n\nimplementing reproducible spatial analysis with open-source methods, and\n\ncommunicating the results through maps, tables, and an interactive website.\n\nThe goal of this project is to demonstrate how quantitative geospatial analysis can support planning practice—particularly in understanding who can access essential services, how transit networks shape accessibility, and where coverage gaps may emerge.\nIf you have comments, feedback, or suggestions, feel free to reach out:\n\nEmail: zonghua@upenn.edu\n\nThank you for visiting this site!"
  },
  {
    "objectID": "website/city_nyc.html",
    "href": "website/city_nyc.html",
    "title": "New York City",
    "section": "",
    "text": "1. Bus stops and boundary\n\nNew York City contains 3,381 bus stops distributed across its five boroughs.\nThe spatial distribution in this map highlights several clear patterns:\n\nManhattan exhibits the highest point density, with evenly spaced stops following the street grid.\nThis pattern reflects Manhattan’s extremely high block density and intensive surface transit demand.\nBrooklyn and Queens show wide coverage but with more irregular spacing, consistent with more diverse street networks and lower building density.\nThe Bronx displays a moderate density of stops, particularly along major north–south corridors.\nStaten Island is much more sparsely served, aligned with its car-oriented development pattern.\n\nThese geographic differences already hint at variation in accessibility, later confirmed by the nearest-neighbour and KDE analysis.\n\n\n\n2. 500 m Euclidean coverage\n\nApproximately 56.1% of New York City lies within a 500 m walking distance (Euclidean) of a bus stop.\nInterpreting this map:\n\nKey insights\n\nManhattan achieves near-universal coverage, especially below 110th Street.\nThe combination of narrow blocks and many parallel bus corridors makes almost the entire island fall within a 500 m radius.\nBrooklyn and Queens show significant coverage gaps, especially in low-density or industrial areas.\nStaten Island once again lags behind, with large residential zones beyond walkable bus access.\n\n\n\nWhy does NYC not reach &gt;70% coverage?\nEven though stop density is relatively high, New York covers a very large land area (1,362 km²).\nLarge parks, airports, industrial areas, low-density districts, and waterfront zones reduce the overall coverage ratio.\n\n\n\n\n3. 500 m network-based coverage\n\nUsing the street network instead of straight-line distance gives a more realistic view of where people can walk to a stop within 500 m along walkable paths.\n\nOverall result\n\nThe network-based coverage ratio is about 43.3%, notably lower than the 56.1% from Euclidean buffers.\nIn other words, once we respect the actual street layout, around one sixth of the land that looks “covered” in Euclidean space is not reachable within 500 m of walking.\n\n\n\nWhat changes compared with Euclidean coverage?\n\nWater bodies and expressways become more visible barriers:\n\nAreas near waterfronts or separated by highways may fall inside a 500 m circle but require long detours along bridges or underpasses.\n\nThese zones shrink in the network-based map.\n\nManhattan remains highly accessible, but coverage along the edges (Hudson/East River waterfronts, large parks such as Central Park) is thinner once only real walking paths are allowed.\nBrooklyn and Queens show larger uncovered pockets, especially in:\n\nindustrial waterfronts,\nlow-density residential districts with discontinuous street grids.\n\nStaten Island looks particularly constrained: cul-de-sacs, limited bridges, and hilly topography all reduce network-based walking access.\n\n\n\nInterpretation\nThe comparison between the Euclidean and network maps highlights that:\n\nStreet connectivity is as important as stop density.\nEven with many stops, disconnected or barrier-heavy street networks reduce effective walking access.\nNYC’s overall accessibility is uneven.\nDense, well-connected grids (Manhattan, parts of Brooklyn/Queens) are robust under both measures, while peripheral and car-oriented areas lose much of their apparent coverage when we switch to a realistic walking metric.\n\n\n\n\n\n4. Kernel density heatmap\n\nThe kernel density estimation (KDE) heatmap visually emphasises intensity of bus stop clustering, independent of administrative boundaries.\n\nKey spatial patterns\n\nThe brightest concentration runs down the spine of Manhattan, reflecting the street grid’s dense transit corridors (e.g., Madison, Lexington, Broadway, 1st–5th Avenues).\nOther strong clusters appear in:\n\nDowntown Brooklyn & Brooklyn Heights\n\nWestern Queens (Astoria, Long Island City)\n\nThe Bronx South and West\n\n\n\n\nWhy does Manhattan stand out so strongly?\n\nSmall block size → more intersections → more stop placement opportunities\n\nHigh population and job density → need for very frequent bus service\n\nComplementary to subway network → bus feeders and crosstown routes fill subway gaps\n\nLegacy streetcar routes → many modern bus lines follow historic trolley lines\n\nKDE complements the raw stop map by showing relative clustering intensity, whereas the 500 m coverage (Euclidean and network-based) shows accessibility of land area.\nTogether, these layers reveal both where stops are and how intensively they are concentrated.\n\n\n\n\n5. Nearest-neighbour distances\n\nNearest-neighbour (NN) analysis quantifies how close the typical bus stop is to the next one.\nThe distribution is heavily right-skewed:\n\nStatistics (from summary table)\n\nMean distance: 183 m\n\nMedian distance: 108 m\n\n90th percentile: 394 m\n\nMaximum: &gt; 2.4 km (mostly Staten Island or fringe industrial areas)\n\n\n\nInterpretation\n\nMost bus stops in NYC are very close to each other (100–200 m).\nThis reflects high service frequency and redundancy in dense boroughs.\nThe long-tail of the histogram represents isolated stops in low-density areas.\nStaten Island and parts of eastern Queens contribute disproportionately to the high-distance outliers.\n\n\n\nSpatial NN map interpretation\nThe right-hand map shows: - Dark purple points (short NN distance) → Manhattan, Downtown Brooklyn, LIC\n- Green/yellow points (long NN distance) → outer borough peripheries, Staten Island\nNN distance complements KDE by quantifying spacing regularity; KDE identifies clusters, while NN identifies local gaps.\n\n\n\n\n6. Manhattan bus network (high-density reference)\n\nImage source: NYCMap360°, Official Manhattan Bus Map (NYC Bus Maps).\nManhattan’s bus map illustrates why it dominates NYC’s clustering patterns:\n\nDozens of north–south avenues support parallel bus corridors.\nFrequent crosstown routes fill gaps between subway lines.\nThe grid structure allows extremely consistent spacing of stops — often every 2–3 blocks (120–180 m), matching our calculated NN statistics.\n\nThis map visually reinforces the interpretation from all previous figures:\nManhattan is the core of NYC’s bus accessibility system, both in density and coverage."
  },
  {
    "objectID": "website/city_sh.html",
    "href": "website/city_sh.html",
    "title": "Shanghai",
    "section": "",
    "text": "1. Bus stops and boundary\n\nThe point map shows an extremely dense web of bus stops across Shanghai’s main urban area. Coverage is close to continuous in the historic Puxi core and along major corridors extending towards the south and southeast. By contrast, the western and southern edges of the polygon appear more weakly served, with clearer gaps between linear clusters of stops.\nA key data limitation is visible here. The boundary used for Shanghai comes from an open-data administrative layer and represents the entire municipality, including the main urban area and outlying islands such as Chongming. As a result, the reference area contains substantial amounts of water, port land, industrial space and peri-urban green space that are only sparsely served by buses.\nThis choice has two implications:\n\nSome land inside the boundary is not actually urbanised, which dilutes density metrics (stops per km²) relative to the intensity of development.\n“Outlying districts and islands are included in the reference area, but many of them have very low stop density, which pulls down the citywide averages. The maps visually focus on the metropolitan core where most stops are concentrated.”\n\nThese caveats are important when interpreting the comparative results: Shanghai’s bus system appears less dense than Singapore or Amsterdam partly because its reference area is larger and more heterogeneous.\n\n\n\n2. 500 m Euclidean coverage\n\nThe 500 m coverage map shows that most of the built-up portion of the polygon lies within walking distance of at least one bus stop. In the central districts the red dots (stops) sit inside an almost continuous field of buffers, especially along the north–south spine of Puxi and across the eastern “fan” in Pudong.\nFrom the summary table, Shanghai’s Euclidean 500 m coverage ratio is about 0.475 – that is, roughly 47.5% of the boundary area lies within 500 m of a stop, corresponding to about 3,855 km² of land. This is somewhat lower than the 55–57% coverage found for the other cities, but still substantial given Shanghai’s very large total area (8,115 km² in this definition) and the amount of non-urban land included in the polygon.\nTwo points are worth noting:\n\nWithin the continuous built-up core, Euclidean coverage is extremely high; the lower citywide ratio is largely driven by agricultural land, wetlands and industrial zones along the edges.\nBecause Euclidean buffers ignore street topology, they may overestimate walkable access in places with barriers such as waterways, fenced compounds or limited crossing opportunities.\n\n\n\n\n3. 500 m network-based coverage\n\nTo address the limitations of straight-line distance, a second indicator uses network-based walking distance along the OpenStreetMap street graph. Here, for each bus stop, all street segments reachable within 500 m walking distance are buffered (with a small lateral offset to turn lines into walkable “corridors”) and merged into a single coverage polygon.\nFor Shanghai this network-based 500 m coverage ratio is about 0.158 – only 15.8% of the boundary area (≈ 1,281 km²) lies within 500 m along the street network of any bus stop. The contrast with the Euclidean value (47.5%) is substantial and highlights two features of the urban structure:\n\nMany apparent gaps in the Euclidean map are in fact hard to reach on foot because of expressways, rail yards, rivers or superblocks.\nWalkable coverage is concentrated in a denser inner band, while the outer edges contain long, corridor-like routes with widely spaced intersections and limited sidewalk connectivity.\n\n\nWhy do the three Shanghai maps look so similar?\nVisually, the bus-stop map, the Euclidean coverage map and the network coverage map all appear as a dense red “blob” covering the same main urban area. There are three reasons:\n\nAll three figures plot exactly the same set of bus stops and the same boundary, so their overall outline is identical.\nIn the dense core, both Euclidean and network buffers overlap heavily, producing a solid red patch in all maps – small differences in coverage are hard to see at city scale.\nThe network-based coverage is drawn with a relatively thick buffered corridor around reachable streets; when many corridors overlap, the result again looks almost solid.\n\nThe key differences therefore lie in the numbers rather than in the visual impression: 47.5% Euclidean vs. 15.8% network-based coverage. This becomes an important limitation when using maps for communication: they can suggest “full” coverage even where the network-based indicator shows that effective walkable access is much more restricted.\n\n\n\n\n4. Kernel density heatmap\n\nThe KDE heatmap reveals the internal hierarchy of Shanghai’s bus stop network. High-intensity “ridges” of density run:\n\nnorth–south through the historic core of Puxi, roughly aligned with major arterial roads and metro corridors;\neast–west towards the inner ring and Lujiazui, capturing the radial orientation of routes feeding the central business district;\nsouthward towards emerging sub-centres and new towns.\n\nUnlike Amsterdam, where density peaks are tightly clustered around a relatively small inner core, Shanghai exhibits a broad plateau of medium–high density punctuated by multiple hotspots. This pattern is consistent with Shanghai’s role as a polycentric megacity, where employment and activity are no longer confined to a single CBD.\nWhen compared with Singapore’s heatmap, Shanghai looks less uniformly bright: Singapore’s island-wide planning and strong trunk–feeder structure produce an almost continuous field of high density. In Shanghai, historic street grids, redevelopment patches and industrial belts introduce more variability, with some corridors substantially better served than adjacent neighbourhoods.\n\n\n\n5. Nearest-neighbour distances\n\nThe nearest-neighbour (NN) histogram for Shanghai is heavily skewed towards short distances: most stops lie within 50–150 m of their nearest neighbour, with a heavy tail extending beyond 300 m. From the summary statistics:\n\nMean NN distance: ~91 m\n\nMedian NN distance: ~56 m\n\n90th percentile: ~201 m\n\nMaximum: just over 1.2 km\n\nThese values indicate that for the majority of stops, inter-stop spacing is relatively tight, consistent with dense linear routes along major corridors and local streets. At the same time, the long tail in the histogram reveals a subset of isolated or peripheral stops – likely at the very edge of the urbanised area or on radial highways.\nIn comparative perspective:\n\nShanghai’s mean NN distance (~91 m) is shorter than New York’s (~183 m), reflecting more closely spaced stops and a stronger emphasis on fine-grained local access rather than high-speed bus travel.\nIt is longer than Amsterdam’s (~63 m) and slightly longer than Singapore’s (~80 m), which both combine compact geography with strong transit-oriented planning and, in Amsterdam’s case, a dense tram network.\nThe median NN distance for Shanghai (56 m) is very close to Amsterdam and Singapore, suggesting that typical inner-city stop spacing is comparable, while the longer tail for Shanghai is driven by a few sparse peripheral corridors.\n\nSpatially, the NN map shows the shortest distances clustered in the historic core and key radial corridors, while longer distances appear on:\n\nthe southwestern and southern fringes, where urban expansion meets agricultural or industrial land;\nsome large infrastructure corridors and bridges where stops are tied to interchange nodes rather than local street blocks.\n\nThese patterns reflect Shanghai’s rapid outward urbanisation, where transit infrastructure often precedes fine-grained local street integration.\n\n\n\n6. Shanghai bus network (transit reference)\n\nImage source: Google Maps Transit – Shanghai urban and suburban bus routes.\nThe Google Transit bus-line map complements the stop-based analysis by illustrating the route structure of Shanghai’s bus system. Several features stand out:\n\nA dense radial web centred on the inner districts of Puxi and the Hongqiao–Xujiahui–Lujiazui axis, where multiple overlapping routes follow major arterials.\nRing-like corridors roughly aligned with the inner and middle ring roads, supporting tangential movements that do not pass through the historic core.\nStrong east–west and north–south trunks extending into Pudong and towards satellite towns, where routes run along major expressways and only gradually branch into local grids.\nNoticeable gaps over water and non-urban land (e.g. wetlands, port zones, agricultural areas), which correspond to the empty regions seen along the edges of the analytical boundary.\n\nWhen juxtaposed with the KDE and NN maps, this line map helps explain why coverage remains high despite relatively modest overall density:\n\nThe presence of many overlapping routes in the core produces very short NN distances and high KDE values.\nOutermost corridors are long and relatively straight, with stops spaced further apart, which shows up as the long tail in the NN histogram but contributes little to the coverage ratio because many of these segments run through low-density or industrial land.\n\n\n\n\n7. Data limitations and interpretation\nFor Shanghai, several data and visual limitations are particularly important:\n\nThe city boundary represents the full municipality, including large areas of water, wetlands, agricultural land and outlying islands. These regions contain few or no bus stops, which strongly affects density and coverage metrics.\nBecause all polygons are retained, the analysis incorporates the entire municipal territory rather than only the built-up core. This yields lower density and coverage figures compared with cities whose administrative boundaries align more closely with their continuous urbanised areas.\nThe three main maps (stops, Euclidean coverage, network coverage) look very similar because the core is so densely served that buffers overlap into an almost solid mass. This can give a misleading impression of uniformly high accessibility; the numerical indicators (47.5% vs 15.8% coverage) reveal much stronger contrasts.\nBus stops close to metro or suburban rail interchanges are mapped as points only; the analysis does not explicitly model multimodal accessibility, which is crucial in a metro-rich city like Shanghai.\n\nDespite these limitations, comparing Shanghai to New York, Singapore and Amsterdam under a consistent 500 m coverage and NN framework yields several robust insights:\n\nIn terms of basic spatial access (share of land within 500 m of a bus stop), Shanghai performs broadly similarly to the other cities, once non-urban land is taken into account.\nShanghai’s internal structure – a combination of radial trunks, ring roads and emerging sub-centres – is clearly reflected in the KDE and NN patterns, differentiating it from Singapore’s island-wide uniformity and Amsterdam’s compact monocentric form.\nThe city’s rapid outward growth generates a dual structure: very dense inner-city service with short NN distances, alongside more sparsely served fringe corridors. This suggests that future improvements could focus on filling gaps in newly urbanised areas and rationalising overlapping routes in the saturated core.\n\nOverall, Shanghai’s bus system, as captured by this dataset, sits somewhere between European compact-city density and North American metropolitan scale. Recognising the limitations of the boundary and the visual similarity of the maps is essential for drawing fair comparisons and for grounding any policy recommendations that might be derived from this analysis."
  },
  {
    "objectID": "website/methods.html",
    "href": "website/methods.html",
    "title": "Methods",
    "section": "",
    "text": "This page summarises the analytical workflow and explains why each method was chosen. All analysis is implemented in Python using GeoPandas, Shapely, scikit-learn, and Matplotlib."
  },
  {
    "objectID": "website/methods.html#standardising-crs",
    "href": "website/methods.html#standardising-crs",
    "title": "Methods",
    "section": "1. Standardising CRS",
    "text": "1. Standardising CRS\nAll datasets are first converted to WGS84 geographic coordinates (EPSG:4326). For distance and area calculations, each city is then reprojected into a suitable projected coordinate reference system:\n\nNew York City and Shanghai – EPSG:3857 (Web Mercator)\n\nSingapore – EPSG:3414 (SVY21 / Singapore TM)\n\nAmsterdam – EPSG:28992 (Amersfoort / RD New)\n\nUsing an appropriate metric CRS ensures that area and distance calculations (e.g., buffer radii, nearest-neighbour distances) are interpretable in metres and square kilometres."
  },
  {
    "objectID": "website/methods.html#cleaning-and-merging-boundaries",
    "href": "website/methods.html#cleaning-and-merging-boundaries",
    "title": "Methods",
    "section": "2. Cleaning and Merging Boundaries",
    "text": "2. Cleaning and Merging Boundaries\nCity boundaries often contain small topological artefacts (e.g. slivers, self-intersections). Boundaries are therefore:\n\nExploded into individual polygons,\n\nBuffered by 0 m to repair common geometry issues,\n\nMerged into a single multipolygon per city.\n\nFor Shanghai, the municipal boundary is represented as a multi-polygon (including the main urban area and outlying islands such as Chongming). In this project all polygons belonging to the Shanghai municipality are retained. This means that large water bodies, port areas and peri-urban green space are included in the reference area, which tends to dilute density measures (stops per km²) compared with the intensity of bus service in the built-up core."
  },
  {
    "objectID": "website/methods.html#clipping-bus-stops-to-city-boundaries",
    "href": "website/methods.html#clipping-bus-stops-to-city-boundaries",
    "title": "Methods",
    "section": "3. Clipping Bus Stops to City Boundaries",
    "text": "3. Clipping Bus Stops to City Boundaries\nBus stop points are then clipped to the cleaned boundary of each city. This ensures that all subsequent indicators refer to the same spatial extent when comparing between cities."
  },
  {
    "objectID": "website/methods.html#constructing-pedestrian-street-networks",
    "href": "website/methods.html#constructing-pedestrian-street-networks",
    "title": "Methods",
    "section": "4. Constructing Pedestrian Street Networks",
    "text": "4. Constructing Pedestrian Street Networks\nFor the network-based accessibility indicator, a pedestrian street network is constructed for each city:\n\nUsing OSMnx, a walkable street network is downloaded from OpenStreetMap for the extent of each city (network_type=\"walk\").\n\nThe resulting graph is projected into the same metric CRS as the city boundary so that edge lengths are expressed in metres.\n\nEach bus stop is snapped to its nearest network node; these nodes act as origins for network-based walking distance calculations."
  },
  {
    "objectID": "website/methods.html#bus-stop-density",
    "href": "website/methods.html#bus-stop-density",
    "title": "Methods",
    "section": "1. Bus Stop Density",
    "text": "1. Bus Stop Density\nConcept. Density is defined as the number of bus stops per square kilometre of city area. It is a simple but intuitive measure of the overall supply of boarding opportunities.\nImplementation.\n\nReproject the city boundary to the local metric CRS.\n\nCompute total area (A) (km²).\n\nCount the number of bus stops (N) after clipping.\n\nCalculate：\n\nDensity = N / A (stops per km2)\nwhere N is the number of bus stops inside the city boundary and A is the total city area (km2).\nInterpretation. High density indicates either closely spaced stops or a large number of routes, but does not directly reveal where within the city stops are concentrated. It is therefore complemented by the spatially explicit methods below."
  },
  {
    "objectID": "website/methods.html#m-walking-coverage",
    "href": "website/methods.html#m-walking-coverage",
    "title": "Methods",
    "section": "2. 500 m Walking Coverage",
    "text": "2. 500 m Walking Coverage\nConcept. A 500 m Euclidean buffer is used as a proxy for the area within a reasonable walking distance (approximately 5–7 minutes) of a bus stop. The indicator measures the share of city land that is potentially “bus-accessible”.\nImplementation.\n\nIn the projected CRS, create a 500 m circular buffer around each bus stop.\n\nMerge all buffers into a single coverage polygon.\n\nIntersect the merged buffer with the city boundary.\n\nCompute the ratio：\n\nCoverage_500m = (Area within 500 m of any stop) / (Total city area)\nInterpretation. A city with high 500 m coverage has few large gaps in the bus network, whereas low coverage suggests extensive areas without nearby bus stops. This indicator is sensitive both to density and to how evenly stops are spread across the urban fabric.\n\n2.1 Network-based 500 m Walking Coverage\nConcept. The Euclidean 500 m buffer assumes that people can walk in straight lines. In reality, walking paths are constrained by the street network and barriers such as rivers or railways. A complementary indicator therefore measures 500 m walking coverage along the pedestrian street network.\nInstead of circles, the network-based coverage approximates the area that can be reached by walking up to 500 m along streets from any bus stop.\nImplementation.\n\nStart from the projected pedestrian street network for each city.\n\nSnap each bus stop to its nearest network node.\n\nFor each stop node, run a shortest-path search along the network (Dijkstra) with a maximum path length of 500 m, using edge length as the cost.\n\nCollect all nodes and edges that lie within 500 m walking distance of at least one stop.\n\nBuffer the selected street segments by a small distance (e.g. 20–40 m) to turn them into a continuous coverage polygon.\n\nIntersect this polygon with the city boundary and compute the ratio of covered area to total city area, analogous to the Euclidean measure.\n\nInterpretation. The network-based 500 m coverage is generally more conservative than its Euclidean counterpart, especially in cities with major barriers or coarse street grids. It is more closely aligned with actual walking conditions, but depends on the completeness of pedestrian links in OpenStreetMap. Comparing Euclidean and network-based coverage highlights where straight-line assumptions substantially over-estimate accessibility."
  },
  {
    "objectID": "website/methods.html#kernel-density-estimation-kde",
    "href": "website/methods.html#kernel-density-estimation-kde",
    "title": "Methods",
    "section": "3. Kernel Density Estimation (KDE)",
    "text": "3. Kernel Density Estimation (KDE)\nConcept. Kernel density estimation treats bus stops as a spatial point process and estimates a continuous intensity surface: the expected number of stops per unit area at each location, smoothed over a specified bandwidth. KDE is useful for identifying clusters and corridors of high bus service.\nImplementation.\n\nExtract the projected (x, y) coordinates of all bus stops.\n\nFit a Gaussian kernel density estimator from scikit-learn with a city-specific bandwidth (chosen to reflect typical stop spacing).\n\nCreate a regular grid covering the city extent and evaluate the KDE at each grid cell.\n\nVisualise the resulting intensity surface as a heatmap and overlay the city boundary.\n\nInterpretation. KDE highlights hotspots (dense corridors, terminals, downtown areas) and cold spots (sparsely served edge zones). Comparing heatmaps across the four cities helps to understand whether high densities are concentrated in a small core or more evenly spread."
  },
  {
    "objectID": "website/methods.html#nearest-neighbour-distances",
    "href": "website/methods.html#nearest-neighbour-distances",
    "title": "Methods",
    "section": "4. Nearest-Neighbour Distances",
    "text": "4. Nearest-Neighbour Distances\nConcept. While density summarises the average number of stops per area, the nearest-neighbour distance between stops captures the regularity of spacing along streets and across neighbourhoods. It is derived from point pattern analysis and relates to notions of clustering versus dispersion.\nImplementation.\n\nConstruct a KDTree from stop coordinates in the projected CRS.\n\nFor each stop, query the distance to its second-nearest neighbour (the first neighbour is the stop itself).\n\nStore this distance as nn_dist in the GeoDataFrame.\n\nSummarise the distribution (mean, median, 90th percentile, min, max) and map the nn_dist values.\n\nInterpretation.\n\nShort distances indicate tightly spaced stops or overlapping routes.\n\nLong distances indicate gaps in the network or peripheral areas.\n\nMapping nn_dist reveals whether gaps are localised (e.g. industrial zones, water bodies) or widely distributed."
  },
  {
    "objectID": "website/methods.html#joint-interpretation-of-indicators",
    "href": "website/methods.html#joint-interpretation-of-indicators",
    "title": "Methods",
    "section": "5. Joint Interpretation of Indicators",
    "text": "5. Joint Interpretation of Indicators\nThe indicators are designed to be read together:\n\nA city may have high density but still exhibit low 500 m coverage if stops are clustered in a small core.\n\nKDE highlights where in the city density is concentrated, complementing the scalar density metric.\n\nNearest-neighbour statistics reveal whether accessibility is relatively uniform or if there are pockets of poor coverage.\n\nComparing Euclidean and network-based 500 m coverage indicates how strongly physical barriers, street layout, and network structure constrain walking access relative to straight-line assumptions.\n\nBy juxtaposing these measures, the analysis moves beyond single-number comparisons and offers a richer picture of bus accessibility in each city."
  }
]